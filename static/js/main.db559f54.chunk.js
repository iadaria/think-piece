(this["webpackJsonpthink-piece"]=this["webpackJsonpthink-piece"]||[]).push([[0],{31:function(e,t,a){e.exports=a(48)},36:function(e,t,a){},48:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(29),o=(a(36),a(15)),s=a(2),i=a(3),l=a.n(i),u=a(16),m=a(12),p=a(17),d=a.n(p);a(38),a(41),a(49);d.a.initializeApp({apiKey:"AIzaSyB5ly-UL1WHGnsrbsiZBh6pTaTHkrBMTbA",authDomain:"think-piece-be86e.firebaseapp.com",databaseURL:"https://think-piece-be86e.firebaseio.com",projectId:"think-piece-be86e",storageBucket:"think-piece-be86e.appspot.com",messagingSenderId:"569798124721",appId:"1:569798124721:web:4ae024aae50669c6086e90",measurementId:"G-JP5G8QWR31"});var h=d.a.firestore(),f=d.a.auth(),b=d.a.storage(),v=new d.a.auth.GoogleAuthProvider,E=function(){return f.signInWithPopup(v)},y=function(){return f.signOut()};window.firebase=d.a;var g=function(){var e=Object(m.a)(l.a.mark((function e(t,a){var n,r,c,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n=h.doc("users/".concat(t.uid)),e.next=5,n.get();case 5:if(e.sent.exists){e.next=17;break}return r=t.displayName,c=t.email,o=t.photoURL,s=new Date,e.prev=9,e.next=12,n.set(Object(u.a)({displayName:r,email:c,photoURL:o,createdAt:s},a));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),console.error("Error creating user",e.t0.message);case 17:return e.abrupt("return",C(t.uid));case 18:case"end":return e.stop()}}),e,null,[[9,14]])})));return function(t,a){return e.apply(this,arguments)}}(),C=function(){var e=Object(m.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.abrupt("return",h.collection("users").doc(t));case 6:e.prev=6,e.t0=e.catch(2),console.log("Error fetching user",e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})));return function(t){return e.apply(this,arguments)}}(),O=(d.a,a(4)),j=a(5),w=a(7),k=a(6),N=Object(n.createContext)({user:null}),S=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={user:null},e.unsubscribeFromAuth=null,e.componentDidMount=Object(m.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.unsubscribeFromAuth=f.onAuthStateChanged(function(){var t=Object(m.a)(l.a.mark((function t(a){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=7;break}return t.next=3,g(a);case 3:return n=t.sent,console.log("user from unsubscribeFromAuth",a),n.onSnapshot((function(t){e.setState({user:Object(u.a)({uid:t.id},t.data())})})),t.abrupt("return",e.setState({user:a}));case 7:e.setState({user:null});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)}))),e.componentWillUnmount=function(){e.unsubscribeFromAuth()},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state.user,t=this.props.children;return r.a.createElement(N.Provider,{value:e},t)}}]),a}(n.Component),A=a(18),x=a.n(A);var U=function(e){var t=e.id,a=e.title,c=e.content,s=e.user,i=e.createdAt,l=e.stars,u=e.comments,m=Object(n.useContext)(N),p=h.doc("posts/".concat(t));return r.a.createElement("article",{className:"Post"},r.a.createElement("div",{className:"Post--content"},r.a.createElement(o.b,{to:"/posts/".concat(t)},r.a.createElement("h3",null,a)),r.a.createElement("div",null,c)),r.a.createElement("div",{className:"Post--meta"},r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("span",{role:"img","aria-label":"star"},"\u2b50\ufe0f"),l),r.a.createElement("p",null,r.a.createElement("span",{role:"img","aria-label":"comments"},"\ud83d\ude4a"),u),r.a.createElement("p",null,"Posted by ",s.displayName),r.a.createElement("p",null,x()(i.toDate()).calendar())),r.a.createElement("div",null,r.a.createElement("button",{className:"star",onClick:function(){if(!m)return alert("You should authenticate"),null;p.update({stars:l+1})}},"Star"),function(e,t){return!!e&&e.uid===t.uid}(m,s)&&r.a.createElement("button",{className:"delete",onClick:function(){return p.delete()}},"Delete"))))};U.defaultProps={title:"An Incredibly Hot Take",content:"Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ducimus est aut dolorem, dolor voluptatem assumenda possimus officia blanditiis iusto porro eaque non ab autem nihil! Alias repudiandae itaque quo provident.",user:{id:"123",displayName:"Bill Murray",email:"billmurray@mailinator.com",photoURL:"https://www.fillmurray.com/300/300"},createdAt:new Date,stars:0,comments:0};var P=U,R=a(11),D=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={title:"",content:""},e.handleChange=function(t){var a=t.target,n=a.name,r=a.value;e.setState(Object(R.a)({},n,r))},e.handleSubmit=function(t){if(t.preventDefault(),!f.currentUser)return alert("You should authenticate"),null;var a=e.state,n=a.title,r=a.content,c=f.currentUser||{},o={title:n,content:r,user:{uid:c.uid,displayName:c.displayName,email:c.email,photoURL:c.photoURL},favorites:0,comments:0,createdAt:new Date};h.collection("posts").add(o),e.setState({title:"",content:""})},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state,t=e.title,a=e.content;return r.a.createElement("form",{onSubmit:this.handleSubmit,className:"AddPost"},r.a.createElement("input",{type:"text",name:"title",placeholder:"Title",value:t,onChange:this.handleChange}),r.a.createElement("input",{type:"text",name:"content",placeholder:"Body",value:a,onChange:this.handleChange}),r.a.createElement("input",{className:"create",type:"submit",value:"Create Post"}))}}]),a}(n.Component),I=function(e){return Object(u.a)({id:e.id},e.data())},L=Object(n.createContext)(),F=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={posts:[]},e.unsubscribe=null,e.componentDidMount=Object(m.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.unsubscribe=h.collection("posts").onSnapshot((function(t){var a=t.docs.map(I);console.log("posts in subscribe",a),e.setState({posts:a})}));case 1:case"end":return t.stop()}}),t)}))),e.componentWillUnmount=function(){e.unsubscribe()},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state.posts,t=this.props.children;return r.a.createElement(L.Provider,{value:e},t)}}]),a}(n.Component),B=function(){var e=Object(n.useContext)(L);Object(n.useContext)(N);return r.a.createElement("section",{className:"Posts"},r.a.createElement("div",null,r.a.createElement("h2",null,"Add new post"),r.a.createElement(D,null)),r.a.createElement("h1",null,"Posts"),e.map((function(e){return r.a.createElement(P,Object.assign({},e,{key:e.id}))})))},W=function(e){var t=e.displayName,a=e.photoURL,n=e.email,c=e.createdAt;return r.a.createElement("section",{className:"CurrentUser"},r.a.createElement("div",{className:"CurrentUser--profile"},a&&r.a.createElement("img",{src:a,alt:t}),r.a.createElement("div",{className:"CurrentUser--information"},r.a.createElement(o.b,{to:"/think-piece/profile"},r.a.createElement("h2",null,t)),r.a.createElement("p",{className:"email"},n),r.a.createElement("p",{className:"created-at"},x()(c).calendar()))),r.a.createElement("div",null,r.a.createElement("button",{onClick:y},"Sign Out")))};W.defaultProps={displayName:"Bill Murray",email:"billmurray@mailinator.com",photoURL:"https://www.fillmurray.com/300/300",createdAt:new Date};var M=W,T=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={email:"",password:""},e.handleChange=function(t){var a=t.target,n=a.name,r=a.value;e.setState(Object(R.a)({},n,r))},e.handleSubmit=function(t){t.preventDefault(),e.setState({email:"",password:""})},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password;return r.a.createElement("form",{className:"SignIn",onSubmit:this.handleSubmit},r.a.createElement("h2",null,"Sign In"),r.a.createElement("input",{type:"email",name:"email",placeholder:"Email",value:t,onChange:this.handleChange}),r.a.createElement("input",{type:"password",name:"password",placeholder:"Password",value:a,onChange:this.handleChange}),r.a.createElement("input",{type:"submit",value:"Sign In"}),r.a.createElement("button",{onClick:E},"Sign In With Google"))}}]),a}(n.Component),q=function(){var e=Object(n.useContext)(N);return r.a.createElement("div",null,e?r.a.createElement(M,e):r.a.createElement(T,null))},G=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={displayName:""},e.imageInput=null,e.handleChange=function(t){var a=t.target,n=a.name,r=a.value;e.setState(Object(R.a)({},n,r))},e.handleSumbit=function(t){t.preventDefault();var a=e.state.displayName;a&&e.userRef.update({displayName:a}),e.file&&b.ref().child("user-profiles").child(e.uid).child(e.file.name).put(e.file).then((function(e){return e.ref.getDownloadURL()})).then((function(t){return e.userRef.update({photoURL:t})}))},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this,t=this.state.displayName;return r.a.createElement("section",{className:"UserProfile"},r.a.createElement("form",{onSubmit:this.handleSumbit},r.a.createElement("input",{onChange:this.handleChange,type:"text",value:t,name:"displayName",placeholder:"Display Name"}),r.a.createElement("input",{type:"file",ref:function(t){return e.imageInput=t}}),r.a.createElement("input",{className:"update",type:"submit"})))}},{key:"uid",get:function(){return f.currentUser.uid}},{key:"userRef",get:function(){return h.doc("users/".concat(this.uid))}},{key:"file",get:function(){return this.imageInput&&this.imageInput.files[0]}}]),a}(n.Component),H=function(e){var t=e.content,a=e.user,n=e.createdAt;return r.a.createElement("article",{className:"Comment"},r.a.createElement("span",{className:"Comment--author"},a.displayName),r.a.createElement("span",{className:"Comment--content"},t),r.a.createElement("span",{className:"Comment--timestamp"},x()(n).calendar()))};H.defaultProps={title:"An Incredibly Hot Take",content:"Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ducimus est aut dolorem, dolor voluptatem assumenda possimus officia blanditiis iusto porro eaque non ab autem nihil! Alias repudiandae itaque quo provident.",user:{displayName:"Bill Murray",email:"billmurray@mailinator.com",photoURL:"https://www.fillmurray.com/300/300"},createdAt:new Date};var J=H,z=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={content:""},e.handleChange=function(t){var a=t.target,n=a.name,r=a.value;e.setState(Object(R.a)({},n,r))},e.handleSubmit=function(t){t.preventDefault(),e.props.onCreate(e.state),e.setState({content:""})},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state.content;return r.a.createElement("form",{onSubmit:this.handleSubmit,className:"AddComment"},r.a.createElement("input",{type:"text",name:"content",placeholder:"Comment",value:e,onChange:this.handleChange}),r.a.createElement("input",{className:"create",type:"submit",value:"Create Comment"}))}}]),a}(n.Component),Y=function(e){var t=e.comments,a=e.onCreate;return r.a.createElement("section",{className:"Comments"},r.a.createElement(z,{onCreate:a}),t.map((function(e){return r.a.createElement(J,Object.assign({},e,{key:e.id}))})))},K=function(e){var t,a=function(t){return r.a.createElement(N.Consumer,null,(function(a){return r.a.createElement(e,Object.assign({user:a},t))}))};return a.displayName="WithUser(".concat((t=a).displayName||t.name||"Component",")"),a},Q=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={post:null,comments:[]},e.unsubscribeFromPost=null,e.unsubscribeFromComments=null,e.componentDidMount=Object(m.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.unsubscribeFromPost=e.postRef.onSnapshot((function(t){var a=I(t);e.setState({post:a})})),e.unsubscribeFromComments=e.commentsRef.onSnapshot((function(t){var a=t.docs.map(I);e.setState({comments:a})}));case 2:case"end":return t.stop()}}),t)}))),e.componentWillUnmount=function(){e.unsubscribeFromPost(),e.unsubscribeFromComments()},e.createComment=function(t){var a=e.props.user;e.commentsRef.add(Object(u.a)(Object(u.a)({},t),{},{user:a}))},e}return Object(j.a)(a,[{key:"render",value:function(){var e=this.state,t=e.post,a=e.comments;return r.a.createElement("section",null,t&&r.a.createElement(P,t),r.a.createElement(Y,{comments:a,onCreate:this.createComment}))}},{key:"postId",get:function(){return this.props.match.params.id}},{key:"postRef",get:function(){return h.doc("posts/".concat(this.postId))}},{key:"commentsRef",get:function(){return this.postRef.collection("comments")}}]),a}(n.Component),Z=Object(s.f)(K(Q));var V=function(){return Object(n.useEffect)((function(){var e=window.location.pathname.split("/");console.log("pathname",window.location.pathname),console.log("domain 0",e[0]),console.log("domain 1",e[1])}),[]),r.a.createElement("main",{className:"Application"},r.a.createElement(o.b,{to:"/think-piece/"},r.a.createElement("h1",null,"Think Piece")),r.a.createElement(q,null),r.a.createElement(s.c,null,r.a.createElement(s.a,{exact:!0,path:"/think-piece/",component:B}),r.a.createElement(s.a,{exact:!0,path:"/think-piece/profile",component:G}),r.a.createElement(s.a,{exact:!0,path:"/think-piece/posts/:id",component:Z})))};Object(c.render)(r.a.createElement(o.a,null,r.a.createElement(S,null,r.a.createElement(F,null,r.a.createElement(V,null)))),document.getElementById("root"))}},[[31,1,2]]]);
//# sourceMappingURL=main.db559f54.chunk.js.map